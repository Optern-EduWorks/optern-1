<div class="profile-page-container">
  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>Loading profile...</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="alert alert-error">
    <i class="bi bi-exclamation-triangle-fill"></i>
    {{ errorMessage }}
    <button class="close-btn" (click)="errorMessage = ''">×</button>
  </div>

  <!-- Success Message -->
  <div *ngIf="successMessage" class="alert alert-success">
    <i class="bi bi-check-circle-fill"></i>
    {{ successMessage }}
  </div>

  <!-- Page Header -->
  <header class="page-header">
    <h1>Candidate Profile</h1>
    <p>Manage your candidate profile and personal information.</p>
  </header>

  <!-- Blue User Card -->
  <div class="user-banner">
    <div class="user-avatar">{{ profile.fullName ? (profile.fullName | slice:0:2 | uppercase) : 'NN' }}</div>
    <div class="user-details">
      <h2>{{ profile.fullName || 'New User' }}</h2>
      <div class="user-meta">
        <span><i class="bi bi-briefcase-fill"></i> {{ profile.course || 'Not specified' }} • {{ profile.college || 'Not specified' }}</span>
        <span><i class="bi bi-envelope-fill"></i> {{ profile.email || 'Not specified' }}</span>
        <span><i class="bi bi-calendar-check-fill"></i> Since {{ profile.createdDate ? (profile.createdDate | date:'yyyy') : '2024' }}</span>
      </div>
    </div>
    <button class="edit-profile-btn" (click)="selectTab('personal')"><i class="bi bi-pencil-fill"></i> Edit Profile</button>
  </div>

  <!-- Tabs Navigation (MODIFIED) -->
  <nav class="profile-tabs">
    <a class="tab-link" [class.active]="activeTab === 'personal'" (click)="selectTab('personal')">
      <i class="bi bi-person-circle"></i> Personal
    </a>
    <a class="tab-link" [class.active]="activeTab === 'academic'" (click)="selectTab('academic')">
      <i class="bi bi-mortarboard-fill"></i> Academic
    </a>
    <a class="tab-link" [class.active]="activeTab === 'notification'" (click)="selectTab('notification')">
      <i class="bi bi-bell-fill"></i> Notification
    </a>
    <a class="tab-link" [class.active]="activeTab === 'security'" (click)="selectTab('security')">
      <i class="bi bi-shield-lock-fill"></i> Security
    </a>
  </nav>

  <!-- Tab Content Area (MODIFIED) -->
  <div class="tab-content-container">
    <!-- Personal Tab Content -->
    <div *ngIf="activeTab === 'personal'">
      <div class="form-header">
        <h3 class="form-title">Personal Information</h3>
        <p class="form-subtitle">Update your personal details and contact information.</p>
      </div>
      <form class="profile-form" (ngSubmit)="saveProfile()" #personalForm="ngForm">
        <div class="form-row">
          <div class="form-field">
            <label for="full-name">Full Name</label>
            <input type="text" id="full-name" name="fullName"
                   [(ngModel)]="editProfile.fullName" placeholder="Enter full name" required>
          </div>
          <div class="form-field">
            <label for="email">Email Address</label>
            <input type="email" id="email" name="email"
                   [(ngModel)]="editProfile.email" placeholder="Enter email address" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-field">
            <label for="phone">Phone Number</label>
            <input type="text" id="phone" name="phone"
                   [(ngModel)]="editProfile.phoneNumber" placeholder="Enter phone number" required>
          </div>
          <div class="form-field">
            <label for="dob">Date of Birth</label>
            <input type="date" id="dob" name="dob"
                   [(ngModel)]="editProfile.dateOfBirth" placeholder="Select date of birth">
          </div>
        </div>
        <div class="form-row single-column">
          <div class="form-field">
            <label for="address">Address</label>
            <textarea id="address" name="address"
                      [(ngModel)]="editProfile.address" placeholder="Enter your address" rows="3"></textarea>
          </div>
        </div>
        <div class="form-row">
          <div class="form-field">
            <label for="linkedin">LinkedIn Profile</label>
            <input type="url" id="linkedin" name="linkedin"
                   [(ngModel)]="editProfile.linkedInProfile" placeholder="https://linkedin.com/in/yourprofile">
          </div>
          <div class="form-field">
            <label for="gender">Gender</label>
            <select id="gender" name="gender" [(ngModel)]="editProfile.gender">
              <option value="">Select gender</option>
              <option value="Male">Male</option>
              <option value="Female">Female</option>
              <option value="Other">Other</option>
              <option value="Prefer not to say">Prefer not to say</option>
            </select>
          </div>
        </div>
        <div class="form-actions">
          <button type="submit" class="save-btn" [disabled]="isSaving || personalForm.invalid">
            {{ isSaving ? 'Saving...' : 'Update Profile' }}
          </button>
          <button type="button" class="cancel-btn" (click)="cancelEdit()" [disabled]="isSaving">Cancel</button>
        </div>
      </form>
    </div>

    <!-- Academic Tab Content (NEW) -->
    <div *ngIf="activeTab === 'academic'">
      <div class="form-header">
        <h3 class="form-title">Academic Information</h3>
        <p class="form-subtitle">Manage your educational background and qualifications.</p>
      </div>

      <form class="profile-form" (ngSubmit)="saveAcademicInfo()" #academicForm="ngForm">
        <!-- Current Education Section -->
        <h4 class="form-section-title">Current Education</h4>
        <div class="form-row">
          <div class="form-field">
            <label for="college">College/University</label>
            <input type="text" id="college" name="college"
                   [(ngModel)]="editProfile.college" placeholder="Enter college name" required>
          </div>
          <div class="form-field">
            <label for="course">Course/Degree</label>
            <input type="text" id="course" name="course"
                   [(ngModel)]="editProfile.course" placeholder="Enter course/degree" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-field">
            <label for="graduationYear">Expected Graduation Year</label>
            <input type="number" id="graduationYear" name="graduationYear"
                   [(ngModel)]="editProfile.graduationYear" placeholder="2024" min="2020" max="2030">
          </div>
          <div class="form-field">
            <label for="currentSemester">Current Semester</label>
            <select id="currentSemester" name="currentSemester" [(ngModel)]="editProfile.currentSemester">
              <option value="">Select semester</option>
              <option value="1st Semester">1st Semester</option>
              <option value="2nd Semester">2nd Semester</option>
              <option value="3rd Semester">3rd Semester</option>
              <option value="4th Semester">4th Semester</option>
              <option value="5th Semester">5th Semester</option>
              <option value="6th Semester">6th Semester</option>
              <option value="7th Semester">7th Semester</option>
              <option value="8th Semester">8th Semester</option>
              <option value="Completed">Completed</option>
            </select>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="save-btn" [disabled]="isSaving || academicForm.invalid">
            {{ isSaving ? 'Saving...' : 'Update Academic Info' }}
          </button>
          <button type="button" class="cancel-btn" (click)="cancelEdit()" [disabled]="isSaving">Cancel</button>
        </div>
      </form>
    </div>
    <!-- Notification Tab Content (NEW) -->
    <div *ngIf="activeTab === 'notification'">
      <div class="form-header">
        <h3 class="form-title">Notification Preferences</h3>
        <p class="form-subtitle">Manage how you receive notifications and updates.</p>
      </div>

      <div class="notification-settings">
        <div class="setting-item">
          <div class="setting-details">
            <h4>Email Notifications</h4>
            <p>Receive important updates via email.</p>
          </div>
          <label class="switch">
            <input type="checkbox" [(ngModel)]="notificationSettings.emailNotifications">
            <span class="slider"></span>
          </label>
        </div>
        <div class="setting-item">
          <div class="setting-details">
            <h4>Job Application Updates</h4>
            <p>Get notified about application status changes.</p>
          </div>
          <label class="switch">
            <input type="checkbox" [(ngModel)]="notificationSettings.jobApplicationUpdates">
            <span class="slider"></span>
          </label>
        </div>
        <div class="setting-item">
          <div class="setting-details">
            <h4>Interview Reminders</h4>
            <p>Receive reminders for scheduled interviews.</p>
          </div>
          <label class="switch">
            <input type="checkbox" [(ngModel)]="notificationSettings.interviewReminders">
            <span class="slider"></span>
          </label>
        </div>
        <div class="setting-item">
          <div class="setting-details">
            <h4>Marketing Communications</h4>
            <p>Receive promotional emails and notifications.</p>
          </div>
          <label class="switch">
            <input type="checkbox" [(ngModel)]="notificationSettings.marketingCommunications">
            <span class="slider"></span>
          </label>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="save-btn" (click)="saveNotificationPreferences()">Save Preferences</button>
        <button type="button" class="cancel-btn" (click)="notificationSettings = {emailNotifications: true, jobApplicationUpdates: true, interviewReminders: true, marketingCommunications: false}">Reset to Default</button>
      </div>
    </div>

    <!-- Security Tab Content (NEW) -->
    <div *ngIf="activeTab === 'security'">
      <div class="form-header">
        <h3 class="form-title">Security Settings</h3>
        <p class="form-subtitle">Manage your account security and privacy settings.</p>
      </div>

      <form class="profile-form">
        <!-- Password Management -->
        <h4 class="form-section-title">Password Management</h4>
        <div class="form-row single-column">
          <div class="form-field password-field">
            <label for="current-password">Current Password</label>
            <input type="password" id="current-password" name="currentPassword"
                   [(ngModel)]="passwordData.currentPassword"
                   [type]="passwordVisibility.current ? 'text' : 'password'">
            <i class="bi {{ passwordVisibility.current ? 'bi-eye' : 'bi-eye-slash' }} toggle-password"
               (click)="togglePasswordVisibility('current')"></i>
          </div>
        </div>
        <div class="form-row single-column">
          <div class="form-field password-field">
            <label for="new-password">New Password</label>
            <input type="password" id="new-password" name="newPassword"
                   [(ngModel)]="passwordData.newPassword"
                   [type]="passwordVisibility.new ? 'text' : 'password'">
            <i class="bi {{ passwordVisibility.new ? 'bi-eye' : 'bi-eye-slash' }} toggle-password"
               (click)="togglePasswordVisibility('new')"></i>
          </div>
        </div>
        <div class="form-row single-column">
          <div class="form-field password-field">
            <label for="confirm-password">Confirm New Password</label>
            <input type="password" id="confirm-password" name="confirmPassword"
                   [(ngModel)]="passwordData.confirmPassword"
                   [type]="passwordVisibility.confirm ? 'text' : 'password'">
            <i class="bi {{ passwordVisibility.confirm ? 'bi-eye' : 'bi-eye-slash' }} toggle-password"
               (click)="togglePasswordVisibility('confirm')"></i>
          </div>
        </div>
        <div class="form-actions">
          <button type="button" class="save-btn" (click)="updatePassword()">Update Password</button>
        </div>

        <!-- Two-Factor Authentication -->
        <h4 class="form-section-title">Two-Factor Authentication (2FA)</h4>
        <div class="security-feature">
          <div class="setting-details">
            <h4>Enable 2FA</h4>
            <p>Add an extra layer of security to your account.</p>
          </div>
          <button class="save-btn">Setup 2FA</button>
        </div>

        <!-- Login Sessions -->
        <h4 class="form-section-title">Login Sessions</h4>
        <div class="security-feature">
          <div class="setting-details">
            <h4>Active Sessions</h4>
            <p>View and manage devices logged into your account.</p>
          </div>
          <button class="view-sessions-btn">
            <i class="bi bi-laptop"></i> View Active Sessions
          </button>
        </div>
      </form>
    </div>

  </div>
</div>
