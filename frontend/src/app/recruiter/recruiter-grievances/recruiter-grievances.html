<div class="grievances-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title"><span class="highlight">Grievances</span> & Support</h1>
      <p class="page-description">Submit and track your concerns. We're here to help resolve any issues.</p>
    </div>
    <button class="submit-grievance-btn" (click)="openSubmitModal()">
      <span class="plus-icon">+</span> Submit Grievance
    </button>
  </div>

  <!-- Tabs Navigation -->
  <div class="tabs-navigation">
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'all'"
      (click)="setActiveTab('all')">
      All Grievances
      <span class="tab-count">{{ tabCounts.all }}</span>
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'submitted'"
      (click)="setActiveTab('submitted')">
      Submitted
      <span class="tab-count">{{ tabCounts.submitted }}</span>
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'in-review'"
      (click)="setActiveTab('in-review')">
      In Review
      <span class="tab-count">{{ tabCounts.inReview }}</span>
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'resolved'"
      (click)="setActiveTab('resolved')">
      Resolved
      <span class="tab-count">{{ tabCounts.resolved }}</span>
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'closed'"
      (click)="setActiveTab('closed')">
      Closed
      <span class="tab-count">{{ tabCounts.closed }}</span>
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <i class="bi bi-hourglass-split"></i>
    <p>Loading grievances...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="error-state">
    <i class="bi bi-exclamation-triangle"></i>
    <p>{{ error }}</p>
    <button class="retry-btn" (click)="loadGrievances()">Try Again</button>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && !error && filteredGrievances.length === 0" class="empty-state">
    <i class="bi bi-shield-exclamation"></i>
    <h3>No grievances found</h3>
    <p>No grievances have been submitted yet.</p>
  </div>

  <!-- Grievances List -->
  <div class="grievances-list" *ngIf="!isLoading && !error && filteredGrievances.length > 0">
    <div class="grievance-card" *ngFor="let grievance of filteredGrievances">
      <div class="grievance-header">
        <div class="grievance-title-section">
          <h3 class="grievance-title">{{ grievance.title }}</h3>
          <span class="priority-badge" [ngClass]="getPriorityClass(grievance.priority)">
            {{ grievance.priority }}
          </span>
        </div>
        <div class="grievance-actions">
          <span class="status-badge" [ngClass]="getStatusClass(grievance.status)">
            <span class="status-icon" *ngIf="grievance.status === 'in-review'">‚ö†</span>
            <span class="status-icon" *ngIf="grievance.status === 'resolved'">‚úì</span>
            <span class="status-icon" *ngIf="grievance.status === 'closed'">‚óã</span>
            {{ getStatusText(grievance.status) }}
          </span>
          <button class="view-details-btn" (click)="viewDetails(grievance.greivanceID)">
            <span class="eye-icon">üëÅ</span> View Details
          </button>
        </div>
      </div>

      <div class="grievance-meta">
        <span class="meta-item">Submitted: {{ formatDate(grievance.createdDate) }}</span>
        <span class="meta-separator">‚Ä¢</span>
        <span class="meta-item">By: User #{{ grievance.submittedBy }}</span>
      </div>

      <p class="grievance-description">{{ grievance.description }}</p>

      <div class="grievance-footer">
        <!-- Note: Attachments and responses are not in the current backend model -->
      </div>
    </div>
  </div>
</div>

<!-- Submit Grievance Modal -->
<div class="modal-overlay" *ngIf="showSubmitModal" (click)="closeSubmitModal()">
  <div class="modal-content submit-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div>
        <h2>Submit a Grievance</h2>
        <p class="modal-subtitle">Describe your concern and we'll help resolve it.</p>
      </div>
      <button class="close-btn" (click)="closeSubmitModal()">√ó</button>
    </div>

    <div class="modal-body">
      <form class="grievance-form">
        <!-- Title Field -->
        <div class="form-group full-width">
          <label class="form-label">Title <span class="required">*</span></label>
          <input 
            type="text" 
            class="form-input" 
            placeholder="Brief summary of your issue"
            [(ngModel)]="grievanceForm.title"
            name="title">
        </div>

        <!-- Category and Priority -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Category <span class="required">*</span></label>
            <select class="form-select" [(ngModel)]="grievanceForm.category" name="category">
              <option value="technical">Technical Issue</option>
              <option value="application">Application Related</option>
              <option value="company">Company Related</option>
              <option value="other">Other</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Priority <span class="required">*</span></label>
            <select class="form-select" [(ngModel)]="grievanceForm.priority" name="priority">
              <option value="low">Low</option>
              <option value="medium">Medium</option>
              <option value="high">High</option>
            </select>
          </div>
        </div>

        <!-- Description Field -->
        <div class="form-group full-width">
          <label class="form-label">Description <span class="required">*</span></label>
          <textarea 
            class="form-textarea" 
            rows="5" 
            placeholder="Please provide detailed information about your issue..."
            [(ngModel)]="grievanceForm.description"
            name="description"></textarea>
        </div>

        <!-- File Upload -->
        <div class="form-group full-width">
          <label class="form-label" for="file-upload">Attachments (Optional)</label>
          <div class="file-upload-container">
            <input
              type="file"
              id="file-upload"
              class="file-input"
              (change)="onFileSelected($event)"
              accept=".png,.jpg,.jpeg,.pdf,.doc,.docx"
              style="display: none;">
            <label for="file-upload" class="file-drop-area" [class.file-selected]="selectedFile">
              <div class="upload-content">
                <i class="bi bi-cloud-arrow-up" *ngIf="!selectedFile"></i>
                <i class="bi bi-file-earmark-check" *ngIf="selectedFile"></i>
                <div class="upload-text">
                  <span *ngIf="!selectedFile">Click to upload or drag and drop</span>
                  <span *ngIf="selectedFile">{{ selectedFile.name }}</span>
                </div>
                <small class="upload-hint" *ngIf="!selectedFile">PNG, JPG, PDF, DOC up to 10MB each</small>
                <small class="file-size" *ngIf="selectedFile">({{ (selectedFile.size / 1024 / 1024).toFixed(2) }} MB)</small>
              </div>
            </label>
          </div>
          <div *ngIf="selectedFile" class="selected-file-actions">
            <button type="button" class="remove-file-btn" (click)="selectedFile = null" title="Remove file">
              <i class="bi bi-x"></i> Remove
            </button>
          </div>
        </div>
      </form>
    </div>

    <div class="modal-footer">
      <button class="cancel-btn" (click)="closeSubmitModal()" [disabled]="isSubmitting">Cancel</button>
      <button class="submit-btn" (click)="submitGrievance()" [disabled]="!grievanceForm.title.trim() || !grievanceForm.description.trim() || isSubmitting">
        <span class="send-icon" *ngIf="!isSubmitting">üì§</span>
        <span class="loading-spinner" *ngIf="isSubmitting"></span>
        {{ isSubmitting ? 'Submitting...' : 'Submit Grievance' }}
      </button>
    </div>
  </div>
</div>

<!-- Grievance Detail Modal -->
<div class="modal-overlay" *ngIf="showDetailModal && selectedGrievance" (click)="closeDetailModal()">
  <div class="modal-content detail-modal" (click)="$event.stopPropagation()">
    <button class="close-btn" (click)="closeDetailModal()">√ó</button>

    <div class="detail-header">
      <h2 class="detail-title">{{ selectedGrievance.title }}</h2>
      <p class="detail-id">Grievance #{{ selectedGrievance.greivanceID }}</p>
    </div>

    <div class="detail-status-bar">
      <span class="status-badge-large" [ngClass]="getStatusClass(selectedGrievance.status)">
        {{ getStatusText(selectedGrievance.status) }}
      </span>
      <div class="detail-dates">
        <p class="detail-date">Submitted: {{ formatDate(selectedGrievance.createdDate) }}</p>
        <p class="detail-date">Submitted By: User #{{ selectedGrievance.submittedBy }}</p>
      </div>
    </div>

    <div class="detail-meta">
      <div class="meta-row">
        <span class="meta-label">Priority:</span>
        <span class="priority-badge-small" [ngClass]="getPriorityClass(selectedGrievance.priority)">
          {{ selectedGrievance.priority }}
        </span>
      </div>
    </div>

    <div class="detail-section">
      <h3 class="section-title">Description</h3>
      <p class="section-content">{{ selectedGrievance.description }}</p>
    </div>

    <!-- Note: Attachments and responses are not in the current backend model -->

    <div class="detail-footer">
      <button class="close-detail-btn" (click)="closeDetailModal()">Close</button>
    </div>
  </div>
</div>
