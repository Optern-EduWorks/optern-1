import{b as g}from"./chunk-RG4DZT4R.js";import{K as n,O as c,S as b,j as l,q as s}from"./chunk-3PLKYEVT.js";var h=class a{constructor(t){this.http=t;this.startPeriodicRefresh()}baseUrl="/api/Jobs";jobsSubject=new l([]);recruiterJobsSubject=new l([]);jobs$=this.jobsSubject.asObservable();recruiterJobs$=this.recruiterJobsSubject.asObservable();refreshInterval=3e4;startPeriodicRefresh(){console.log("Starting periodic refresh"),this.refreshAllJobs(),this.refreshRecruiterJobs(),setInterval(()=>{console.log("Running periodic refresh"),this.refreshAllJobs(),this.refreshRecruiterJobs()},this.refreshInterval)}refreshAllJobs(){console.log("Refreshing all jobs"),this.getAllFromServer().subscribe({next:t=>{console.log("Received all jobs:",t),this.jobsSubject.next(t)},error:t=>{console.error("Error fetching all jobs:",t)}})}refreshRecruiterJobs(){console.log("Refreshing recruiter jobs"),this.getByRecruiterFromServer().subscribe({next:t=>{console.log("Received recruiter jobs:",t),this.recruiterJobsSubject.next(t)},error:t=>{console.error("Error fetching recruiter jobs:",t)}})}mapServerToUi(t){console.log("Mapping server data to UI:",t);let e=t.skills?t.skills.split(",").map(i=>i.trim()).filter(i=>i.length>0):[],o=t.PostedDate||t.postedDate||t.Posted||t.posted?new Date(t.PostedDate??t.postedDate??t.Posted??t.posted).toLocaleDateString():new Date().toLocaleDateString(),r=t.RemoteAllowed===!0?"Remote":"Onsite",p={jobID:t.jobID??t.JobID??0,title:t.title??t.Title??"Untitled",company:t.company?.name??t.Company?.Name??t.company??"Unknown Company",location:t.location??t.Location??"Not specified",salary:t.salary??t.SalaryRange??"Competitive",remote:t.remote??t.RemoteAllowed??!1,type:t.type??t.EmploymentType??"Full-time",applicants:t.applicants??0,skills:e.length?e:["General"],description:t.description??t.Description??"No description provided.",rating:t.rating??4.5,posted:o,logo:t.logo??"https://i.imgur.com/2JV8V4A.png",priority:t.priority??t.category??t.Category??"medium priority",status:t.status??t.Status??"active",icon:(t.title??t.Title??"U").toString().charAt(0).toUpperCase(),workMode:r,tags:e.map(i=>({label:i,color:"blue"})),requirements:t.requirements??(t.Requirements?t.Requirements.split(","):[])??[],benefits:t.benefits??(t.Benefits?t.Benefits.split(","):[])??[]};return console.log("Mapped job:",p),p}getAllFromServer(){return console.log("Fetching all jobs from server"),this.http.get(this.baseUrl).pipe(s(t=>(console.log("Raw server response (all jobs):",t),t.filter(e=>{let r=new Date(e.closingDate||e.ClosingDate)>=new Date;return r||console.log("Filtering out expired job:",e),r}).map(e=>{let o=this.mapServerToUi(e);return console.log("Mapped job:",o),o}))))}getByRecruiterFromServer(){return console.log("Fetching recruiter jobs from server"),this.http.get(`${this.baseUrl}/by-recruiter`).pipe(s(t=>(console.log("Raw server response (recruiter jobs):",t),(t.jobs||[]).map(o=>{let r=this.mapServerToUi(o);return console.log("Mapped recruiter job:",r),r}))))}getAll(){return this.refreshAllJobs(),this.jobs$}getByRecruiter(){return this.refreshRecruiterJobs(),this.recruiterJobs$}get(t){return this.http.get(`${this.baseUrl}/${t}`).pipe(s(e=>this.mapServerToUi(e)))}create(t){return this.http.post(this.baseUrl,t).pipe(s(e=>this.mapServerToUi(e)),n(()=>{this.refreshAllJobs(),this.refreshRecruiterJobs()}))}update(t,e){return this.http.put(`${this.baseUrl}/${t}`,e).pipe(n(()=>{this.refreshAllJobs(),this.refreshRecruiterJobs()}))}delete(t){return this.http.delete(`${this.baseUrl}/${t}`).pipe(n(()=>{this.refreshAllJobs(),this.refreshRecruiterJobs()}))}static \u0275fac=function(e){return new(e||a)(b(g))};static \u0275prov=c({token:a,factory:a.\u0275fac,providedIn:"root"})};export{h as a};
