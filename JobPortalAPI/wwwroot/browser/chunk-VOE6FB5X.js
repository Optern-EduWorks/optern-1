import{a as f}from"./chunk-YAEOSTW2.js";import{b as c}from"./chunk-RG4DZT4R.js";import{O as u,S as l,m as d,n,q as o,y as i}from"./chunk-3PLKYEVT.js";var g=class s{constructor(e,r){this.http=e;this.authService=r}apiUrl="/api/CandidateProfiles";getProfile(){let e=this.authService.getCurrentUser();return console.log("Getting profile for current user:",e),!e||!e.userId?(console.log("No user logged in, returning default profile"),d(this.getDefaultProfile())):(console.log("Fetching profile for user ID:",e.userId),this.http.get(`${this.apiUrl}/by-user/${e.userId}`).pipe(o(r=>{if(console.log("Profile DTO received:",r),r){let t=this.convertDtoToProfile(r);return console.log("Converted profile:",t),t}return console.log("No profile found for user, returning default"),this.getDefaultProfile()}),i(r=>(console.error("Error fetching profile:",r),r.status===404?(console.log("New endpoint not found, trying fallback method"),this.getProfileFallback(e.userId)):this.handleError(r)))))}getProfileFallback(e){return this.http.get(`${this.apiUrl}`).pipe(o(r=>{if(r&&r.length>0){let t=r.find(a=>a.CandidateID===e);if(t)return this.convertDtoToProfile(t)}return this.getDefaultProfile()}),i(this.handleError))}getProfileById(e){return this.http.get(`${this.apiUrl}/${e}`).pipe(o(r=>this.convertDtoToProfile(r)),i(this.handleError))}createProfile(e){if(console.log("Creating profile:",e),!e)return console.error("Create profile failed: Profile is null or undefined"),n(()=>new Error("Profile data is missing"));let r=this.authService.getCurrentUser();if(!r||!r.userId)return console.error("Create profile failed: No user logged in"),n(()=>new Error("Please log in to save your profile"));let t=this.convertProfileToDto(e);return t.CandidateID=r.userId,t.Email=r.email,t.Status="Active",t.CreatedDate=new Date().toISOString(),t.UpdatedDate=new Date().toISOString(),console.log("Profile DTO before sending to backend:",t),console.log("Creating profile for user:",r.userId,t),this.http.post(`${this.apiUrl}`,t).pipe(o(a=>(console.log("Profile created successfully:",a),this.convertDtoToProfile(a))),i(this.handleError))}updateProfile(e){if(console.log("Updating profile:",e),!e)return console.error("Update profile failed: Profile is null or undefined"),n(()=>new Error("Profile data is missing"));let r=this.authService.getCurrentUser();if(!r||!r.userId||r.userId==null)return console.error("Update profile failed: No user logged in"),n(()=>new Error("Please log in to save your profile"));if(typeof e.candidateID>"u"||e.candidateID===null||e.candidateID===0)return console.error("Profile candidateID is missing, creating new profile"),this.createProfile(e);if(!e.candidateID||e.candidateID===0)return console.log("No candidateID, creating new profile"),this.createProfile(e);let t=this.convertProfileToDto(e);return t.UpdatedDate=new Date().toISOString(),console.log("Profile DTO before updating backend:",t),console.log("Updating existing profile with ID:",e.candidateID),this.http.put(`${this.apiUrl}/${e.candidateID}`,t,{observe:"response"}).pipe(o(a=>(console.log("Profile updated successfully:",a.status),e)),i(this.handleError))}deleteProfile(e){return this.http.delete(`${this.apiUrl}/${e}`).pipe(i(this.handleError))}getDefaultProfile(){return{candidateID:0,fullName:"",email:"",phoneNumber:"",linkedInProfile:"",address:"",dateOfBirth:new Date,gender:"",status:"Active",resumeURL:"",createdDate:new Date,updatedDate:new Date,graduationYear:new Date().getFullYear(),college:"",course:"",currentSemester:"",emailNotifications:!0,jobApplicationUpdates:!0,interviewReminders:!0,marketingCommunications:!1}}convertDtoToProfile(e){return{candidateID:e.CandidateID,fullName:e.FullName,email:e.Email,phoneNumber:e.PhoneNumber,linkedInProfile:e.LinkedInProfile,address:e.Address,dateOfBirth:new Date(e.DateOfBirth),gender:e.Gender,status:e.Status,resumeURL:e.ResumeURL,createdDate:new Date(e.CreatedDate),updatedDate:new Date(e.UpdatedDate),graduationYear:e.GraduationYear,college:e.College,course:e.Course,currentSemester:e.CurrentSemester,emailNotifications:e.EmailNotifications,jobApplicationUpdates:e.JobApplicationUpdates,interviewReminders:e.InterviewReminders,marketingCommunications:e.MarketingCommunications}}convertProfileToDto(e){let r=t=>typeof t=="string"?t.includes("T")?t:new Date(t).toISOString():t.toISOString();return{CandidateID:e.candidateID,FullName:e.fullName,Email:e.email,PhoneNumber:e.phoneNumber,LinkedInProfile:e.linkedInProfile,Address:e.address,DateOfBirth:r(e.dateOfBirth),Gender:e.gender,Status:e.status,ResumeURL:e.resumeURL,CreatedDate:r(e.createdDate),UpdatedDate:r(e.updatedDate),GraduationYear:e.graduationYear,College:e.college,Course:e.course,CurrentSemester:e.currentSemester||"",EmailNotifications:e.emailNotifications??!0,JobApplicationUpdates:e.jobApplicationUpdates??!0,InterviewReminders:e.interviewReminders??!0,MarketingCommunications:e.marketingCommunications??!1}}handleError(e){console.error("Profile service error:",e);let r="An unexpected error occurred";if(e.error instanceof ErrorEvent)r=`Error: ${e.error.message}`;else if(e.error&&typeof e.error=="string")r=e.error;else if(e.message)r=e.message;else switch(e.status){case 404:r="Profile not found";break;case 400:r="Invalid profile data";break;case 500:r="Server error. Please try again later.";break;default:r=`Server returned code: ${e.status}`}return n(()=>new Error(r))}static \u0275fac=function(r){return new(r||s)(l(c),l(f))};static \u0275prov=u({token:s,factory:s.\u0275fac,providedIn:"root"})};export{g as a};
