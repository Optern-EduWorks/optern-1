import{b as p}from"./chunk-RG4DZT4R.js";import{K as c,O as u,S as g,j as l,n as i}from"./chunk-3PLKYEVT.js";var d=class n{constructor(s){this.http=s;let o=localStorage.getItem("optern_user");if(console.log("AuthService constructor - raw localStorage data:",o),o)try{let t=JSON.parse(o);console.log("Parsed user from localStorage:",t),this.currentUserSubject.next(t)}catch(t){console.error("Error parsing user from localStorage:",t),localStorage.removeItem("optern_user")}else console.log("No user data found in localStorage")}currentUserSubject=new l(null);currentUser$=this.currentUserSubject.asObservable();login(s,o){let t={Email:s,Password:o};return console.log("Attempting login for:",s),this.http.post("/api/Auth/login",t,{headers:{"Content-Type":"application/json"}}).pipe(c({next:e=>{console.log("Raw login response:",e);let r;if(e.user?r=e.user:e.data&&e.data.user?r=e.data.user:r=e,console.log("Extracted user data:",r),!r){console.error("No user data in response");return}let a={userId:r.UserId||r.userId||0,role:r.Role||r.role||"",username:r.Username||r.username||"",email:r.Email||r.email||"",token:e.token};if(console.log("Final mapped user:",a),a.userId>0){this.currentUserSubject.next(a);try{localStorage.setItem("optern_user",JSON.stringify(a)),console.log("User saved to localStorage successfully")}catch(m){console.error("Failed to save user to localStorage:",m)}}else console.error("Invalid user data - userId is 0 or missing")},error:e=>{console.error("Login error:",e),console.error("Error details:",{status:e.status,statusText:e.statusText,error:e.error,message:e.message})}}))}register(s){return this.http.post("/api/Users",s)}logout(){this.currentUserSubject.next(null);try{localStorage.removeItem("optern_user")}catch{}}getCurrentUser(){return this.currentUserSubject.value}changePassword(s,o){let t=this.getCurrentUser();if(!t||!t.userId||!t.token)return console.error("Change password failed: No user logged in or no token"),i(()=>new Error("Please log in to change your password"));let e={CurrentPassword:s,NewPassword:o};return console.log("Attempting password change for user:",t.userId),this.http.post("/api/Auth/change-password",e,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.token}`}})}static \u0275fac=function(o){return new(o||n)(g(p))};static \u0275prov=u({token:n,factory:n.\u0275fac,providedIn:"root"})};export{d as a};
